<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>404</title>
		<style>
			body, html {
				background: black;
				border: 0;
				padding: 0;
				margin: 0;
				width: 100%;
				height: 100%;
			}
			canvas {
				position: absolute;
				left: 50%;
				top: 50%;
			}
		</style>
	</head>
	<body>
		
		<canvas><h1>404: Page Not Found</h1></canvas>
		
		<script>
			var err = "404";
			var blockSizeOuter = 60;
			var blockSizeInner = 50;
			var randomness = 0;
			var flicker = false;
			var shrapnel = false;
			var grid1 = [
				"                  ",
				" #  #  ####  #  # ",
				" #  #  #  #  #  # ",
				" #  #  #  #  #  # ",
				" ####  #  #  #### ",
				"    #  #  #     # ",
				"    #  #  #     # ",
				"    #  ####     # ",
				"                  "
			];
			var grid2 = [
				"                ",
				" ####           ",
				" #              ",
				" #              ",
				" #### #### #### ",
				" #    #    #    ",
				" #    #    #    ",
				" #### #    #    ",
				"                "
			];
			var grid = grid1;
			
			var canvas = document.querySelector("canvas");
			
			canvas.width = grid[3].length * blockSizeOuter + randomness;
			canvas.height = grid.length * blockSizeOuter + randomness;
			canvas.style.marginLeft = -canvas.width/2 + "px";
			canvas.style.marginTop = -canvas.height/2 + "px";
			
			var ctx = canvas.getContext("2d");
			
			var dots = ctx.createImageData(blockSizeInner, blockSizeInner);
			var d = dots.data;
			for(var x = 0; x <= dots.width; x += 4){
				for(var y = 0; y <= dots.height; y += 4){
					var i = 4*(x + y*dots.width);
					d[i+0] = 255; //red
					d[i+1] = 128; //green
					d[i+2] = 0;   //blue
					d[i+3] = 255; //alpha
				}
			}
			var dark = ctx.createImageData(blockSizeInner, blockSizeInner);
			var d = dark.data;
			for(var x = 0; x <= dark.width; x += 8){
				for(var y = 0; y <= dark.height; y += 8){
					var i = 4*(x + y*dots.width);
					d[i+0] = 255; //red
					d[i+1] = 128; //green
					d[i+2] = 0;   //blue
					d[i+3] = 255; //alpha
				}
			}
			
			every(100, function(){
				for(var y = 0; y < grid.length; y++){
					for(var x = 0; x < grid[y].length; x++){
						if(grid[y][x] !== " "){
							ctx.putImageData(dots, x*blockSizeOuter+r(), y*blockSizeOuter+r());
							if(flicker){
								ctx.fillStyle = "rgba(0,0,0,"+(Math.random())*(Math.random())+")";
								ctx.fillRect(x*blockSizeOuter, y*blockSizeOuter, blockSizeInner, blockSizeInner);
							}
						}
					}
				}
			});
			
			every(10, function(){
				if(shrapnel)
					for(var y = Math.ceil(Math.random()*3); y < grid.length; y += Math.ceil(Math.random()*5)){
						for(var x = Math.ceil(Math.random()*3); x < grid[y].length; x += Math.ceil(Math.random()*5)){
							if(grid[y][x] !== " "){
								var w = Math.random()*50;
								var h = Math.random()*50;
								ctx.putImageData(
									dots,
									x*blockSizeOuter+r(), y*blockSizeOuter+r(),
									w, h,
									w, h
								);
							}
						}
					}
			});
			
			function start(){
				randomness = 0;
				after(2000, function(){
					flicker = true;
					after(4000, function(){
						randomness = 50;
						after(4000, function(){ msg();
							randomness = 500;
							after(4000, function(){
								/*re*/start();
								after(2000, function(){ msg();
									ctx.clearRect(0, 0, canvas.width, canvas.height);
									after(2000, function(){ msg();
										shrapnel = !shrapnel;
									});
								});
							});
						});
					});
				});
			}
			start();
			function after(t,f){setTimeout(f,t);}
			function every(t,f){setInterval(f,t);}
			function r(){return Math.random()*randomness-randomness/2}
			function msg(){
				var newgrid = (Math.random()<0.5) ? grid1 : grid2;
				if(grid === newgrid) return;
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				grid = newgrid;
			}
		</script>
	</body>
</html>
